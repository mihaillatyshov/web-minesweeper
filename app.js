!function(){"use strict";var e={365:function(e,t,i){var r=i(354),n=i.n(r),s=i(314),o=i.n(s)()(n());o.push([e.id,'* {\r\n    padding: 0;\r\n    margin: 0;\r\n    box-sizing: border-box;\r\n}\r\n\r\n:root {\r\n    --font-color: #333;\r\n    --bg-color: #f8f9fa;\r\n}\r\n\r\n[data-theme="dark"] {\r\n    --font-color: #fff;\r\n    --bg-color: #343a40;\r\n}\r\n\r\nbody {\r\n    padding: 16px;\r\n    height: 100vh;\r\n    height: 100dvh;\r\n    text-align: center;\r\n    color: var(--font-color);\r\n    background-color: var(--bg-color);\r\n}\r\n\r\n#theme-switch {\r\n    position: absolute;\r\n    top: 16px;\r\n    right: 16px;\r\n    cursor: pointer;\r\n}\r\n\r\n#checkbox-theme {\r\n    display: none;\r\n}\r\n\r\n#nav {\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin-bottom: 16px;\r\n    gap: 12px;\r\n}\r\n\r\n#app {\r\n    margin: 0 auto;\r\n}\r\n\r\n.form-field {\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.nav-inputs {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 16px;\r\n    align-items: end;\r\n    margin: 0 auto;\r\n}\r\n\r\ninput {\r\n    padding: 8px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n}\r\n\r\ninput[type="submit"] {\r\n    background-color: #007bff;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="submit"]:hover {\r\n    background-color: #0056b3;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="button"] {\r\n    background-color: #007bff;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="button"]:hover {\r\n    background-color: #0056b3;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="button"]:disabled {\r\n    background-color: #9cccff;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\n.text-danger {\r\n    color: red;\r\n}\r\n\r\n#error-message {\r\n    font-size: 24px;\r\n}\r\n',"",{version:3,sources:["webpack://./src/styles.css"],names:[],mappings:"AAAA;IACI,UAAU;IACV,SAAS;IACT,sBAAsB;AAC1B;;AAEA;IACI,kBAAkB;IAClB,mBAAmB;AACvB;;AAEA;IACI,kBAAkB;IAClB,mBAAmB;AACvB;;AAEA;IACI,aAAa;IACb,aAAa;IACb,cAAc;IACd,kBAAkB;IAClB,wBAAwB;IACxB,iCAAiC;AACrC;;AAEA;IACI,kBAAkB;IAClB,SAAS;IACT,WAAW;IACX,eAAe;AACnB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,aAAa;IACb,sBAAsB;IACtB,mBAAmB;IACnB,SAAS;AACb;;AAEA;IACI,cAAc;AAClB;;AAEA;IACI,aAAa;IACb,sBAAsB;AAC1B;;AAEA;IACI,aAAa;IACb,eAAe;IACf,SAAS;IACT,gBAAgB;IAChB,cAAc;AAClB;;AAEA;IACI,YAAY;IACZ,sBAAsB;IACtB,kBAAkB;AACtB;;AAEA;IACI,yBAAyB;IACzB,YAAY;IACZ,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,yBAAyB;IACzB,YAAY;IACZ,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,yBAAyB;IACzB,YAAY;IACZ,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,yBAAyB;IACzB,YAAY;IACZ,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,yBAAyB;IACzB,YAAY;IACZ,YAAY;IACZ,eAAe;AACnB;;AAEA;IACI,UAAU;AACd;;AAEA;IACI,eAAe;AACnB",sourcesContent:['* {\r\n    padding: 0;\r\n    margin: 0;\r\n    box-sizing: border-box;\r\n}\r\n\r\n:root {\r\n    --font-color: #333;\r\n    --bg-color: #f8f9fa;\r\n}\r\n\r\n[data-theme="dark"] {\r\n    --font-color: #fff;\r\n    --bg-color: #343a40;\r\n}\r\n\r\nbody {\r\n    padding: 16px;\r\n    height: 100vh;\r\n    height: 100dvh;\r\n    text-align: center;\r\n    color: var(--font-color);\r\n    background-color: var(--bg-color);\r\n}\r\n\r\n#theme-switch {\r\n    position: absolute;\r\n    top: 16px;\r\n    right: 16px;\r\n    cursor: pointer;\r\n}\r\n\r\n#checkbox-theme {\r\n    display: none;\r\n}\r\n\r\n#nav {\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin-bottom: 16px;\r\n    gap: 12px;\r\n}\r\n\r\n#app {\r\n    margin: 0 auto;\r\n}\r\n\r\n.form-field {\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.nav-inputs {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 16px;\r\n    align-items: end;\r\n    margin: 0 auto;\r\n}\r\n\r\ninput {\r\n    padding: 8px;\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n}\r\n\r\ninput[type="submit"] {\r\n    background-color: #007bff;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="submit"]:hover {\r\n    background-color: #0056b3;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="button"] {\r\n    background-color: #007bff;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="button"]:hover {\r\n    background-color: #0056b3;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\ninput[type="button"]:disabled {\r\n    background-color: #9cccff;\r\n    color: white;\r\n    border: none;\r\n    cursor: pointer;\r\n}\r\n\r\n.text-danger {\r\n    color: red;\r\n}\r\n\r\n#error-message {\r\n    font-size: 24px;\r\n}\r\n'],sourceRoot:""}]),t.A=o},314:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",r=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),r&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),r&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,r,n,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);r&&o[c[0]]||(void 0!==s&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=s),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),t.push(c))}},t}},354:function(e){e.exports=function(e){var t=e[1],i=e[3];if(!i)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),s="/*# ".concat(n," */");return[t].concat([s]).join("\n")}return[t].join("\n")}},72:function(e){var t=[];function i(e){for(var i=-1,r=0;r<t.length;r++)if(t[r].identifier===e){i=r;break}return i}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],d=r.base?l[0]+r.base:l[0],c=s[d]||0,u="".concat(d," ").concat(c);s[d]=c+1;var h=i(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(f);else{var m=n(f,r);r.byIndex=a,t.splice(a,0,{identifier:u,updater:m,references:1})}o.push(u)}return o}function n(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,n){var s=r(e=e||[],n=n||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=i(s[o]);t[a].references--}for(var l=r(e,n),d=0;d<s.length;d++){var c=i(s[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}s=l}}},659:function(e){var t={};e.exports=function(e,i){var r=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(i)}},540:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:function(e,t,i){e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},825:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var r="";i.supports&&(r+="@supports (".concat(i.supports,") {")),i.media&&(r+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(r+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),r+=i.css,n&&(r+="}"),i.media&&(r+="}"),i.supports&&(r+="}");var s=i.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={id:r,exports:{}};return e[r](s,s.exports,i),s.exports}function r(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.nc=void 0;class n{constructor(e,t,i,n){r(this,"mouseButtonsPressed",new Set),r(this,"mousePosition",[0,0]),this.canvas=e,this.onMouseButtonDown=t,this.onMouseButtonUp=i,this.onWheel=n,window.addEventListener("mousedown",(e=>{this.mouseButtonsPressed.add(e.button),this.onMouseButtonDown&&this.onMouseButtonDown(e.button)})),window.addEventListener("mouseup",(e=>{this.mouseButtonsPressed.delete(e.button),this.onMouseButtonUp&&this.onMouseButtonUp(e.button)})),window.addEventListener("mousemove",(e=>{this.mousePosition=[e.clientX,e.clientY]})),window.addEventListener("contextmenu",(e=>{e.preventDefault()})),e.addEventListener("wheel",(e=>{e.preventDefault(),e.stopPropagation();const t=e.shiftKey?-e.deltaY:e.deltaX,i=e.shiftKey?e.deltaX:e.deltaY;this.onWheel&&this.onWheel(t,i)}))}setOnMouseButtonDown(e){this.onMouseButtonDown=e}setOnMouseButtonUp(e){this.onMouseButtonUp=e}setOnWheel(e){this.onWheel=e}isMouseButtonPressed(e){return this.mouseButtonsPressed.has(e)}getMousePosition(){return{x:this.mousePosition[0]-this.canvas.getBoundingClientRect().left,y:this.canvas.getBoundingClientRect().bottom-this.mousePosition[1]}}isMouseInside(){const e=this.getMousePosition();return e.x>=0&&e.y>=0&&e.x<this.canvas.width&&e.y<this.canvas.height}}const s=32,o=[42,80],a=24,l=22,d=64,c=82,u=52,h=[22,42],f=512;const m=(e,t,i)=>{window.location.href="?cols=".concat(e,"&rows=").concat(t,"&mines=").concat(i)};function w(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let g=null;function p(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class v{constructor(){p(this,"windowWidth",0),p(this,"windowHeight",0),p(this,"cameraPosition",{x:0,y:0}),p(this,"getFieldTextureId",((e,t,i,r)=>{if(!e.isCellExists(t,i))return 23;if(e.isGameOver()){if(e.isCellMarked(t,i)&&!e.isCellHasMine(t,i))return 20;if(e.isCellHasMine(t,i)&&e.isCellOpened(t,i))return 22;if(e.isCellMarked(t,i))return 19;if(e.isCellHasMine(t,i))return 21}else if(e.isGameWin()&&e.isCellHasMine(t,i))return 19;return e.isCellMarked(t,i)?19:r&&e.isCellClosed(t,i)?18:e.isCellOpened(t,i)?0+e.getCellMinesCount(t,i):17}))}baseInit(e,t){this.windowWidth=e,this.windowHeight=t}isScrollAllowed(){return!0}calcCameraMaxLimits(e){return{x:-(e.getFieldColSize()*s-(this.windowWidth-48)),y:-(e.getFieldRowSize()*s-(this.windowHeight-66-d))}}moveCamera(e,t,i){this.isScrollAllowed()&&(this.cameraPosition.x+=t,this.cameraPosition.y+=i);const{x:r,y:n}=this.calcCameraMaxLimits(e);this.cameraPosition.x=Math.min(0,Math.max(r,this.cameraPosition.x)),this.cameraPosition.y=Math.min(0,Math.max(n,this.cameraPosition.y))}getHoveredCell(e){return{col:Math.floor((e.getMousePosition().x-this.cameraPosition.x-24)/s),row:Math.floor((e.getMousePosition().y-this.cameraPosition.y-22)/s)}}isMouseInside(e){const{x:t,y:i}=e.getMousePosition();return e.isMouseInside()&&t>a&&i>l&&t<this.windowWidth-a&&i<this.windowHeight-44-d}getFieldCameraState(e){const t=.01,{x:i,y:r}=this.calcCameraMaxLimits(e);return{isOnBottom:Math.abs(this.cameraPosition.y)<t,isOnTop:Math.abs(this.cameraPosition.y-r)<t,isOnLeft:Math.abs(this.cameraPosition.x)<t,isOnRight:Math.abs(this.cameraPosition.x-i)<t}}getMaxFieldRowAndColCount(e,t){return{maxDrawColCount:Math.floor(e/s)+3,maxDrawRowCount:Math.floor(t/s)+3}}}const A=(e,t,i,r)=>{const n=new i(t.flat()),s={size:n.byteLength,usage:r,mappedAtCreation:!0},o=e.createBuffer(s);return new i(o.getMappedRange()).set(n),o.unmap(),o},C=(e,t,i,r)=>{const n={size:t*i.BYTES_PER_ELEMENT,usage:r|GPUBufferUsage.COPY_DST};return e.createBuffer(n)},b=(e,t,i,r,n,s)=>new Float32Array([2/(t-e),0,0,0,0,2/(r-i),0,0,0,0,1/(s-n),0,(e+t)/(e-t),(r+i)/(i-r),n/(n-s),1]),y=async(e,t)=>{const i=await fetch(t),r=await createImageBitmap(await i.blob()),n=e.createTexture({size:[r.width,r.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return e.queue.copyExternalImageToTexture({source:r},{texture:n},[r.width,r.height]),n},x=()=>document.documentElement.getAttribute("data-theme")||"light";function S(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function B(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const I=[[128,192],[170,192],[212,192],[254,192],[296,192],[338,192],[380,192],[422,192],[464,192],[0,272]];class M{constructor(){B(this,"windowWidth",0),B(this,"windowHeight",0),B(this,"mouseOnFaceDown",!1)}baseInit(e,t){this.windowWidth=e,this.windowHeight=t}isMouseInsideFace(e){const t=e.getMousePosition(),i=this.windowWidth/2-26,r=this.windowHeight-l-32-26;return t.x>=i&&t.x<=i+u&&t.y>=r&&t.y<=r+u}checkFaceClickDown(e){this.mouseOnFaceDown=this.isMouseInsideFace(e)}checkFaceClickUp(e,t){this.mouseOnFaceDown&&this.isMouseInsideFace(t)&&e.generateField(),this.mouseOnFaceDown=!1}}const E=(e,t,i,r)=>({spritePos:e,spriteSize:t,atlasPos:i,atlasSize:r}),P=e=>e-l-32-25,F=(e,t)=>E([0,0],[a,l],[162,272],[a,l]),k=(e,t)=>E([e-a,0],[a,l],[138,272],[a,l]),T=(e,t)=>E([0,t-l],[a,l],[114,272],[a,l]),U=(e,t)=>E([e-a,t-l],[a,l],[90,272],[a,l]),O=(e,t)=>E([a,0],[e-48,l],[211,272],[2,l]),G=(e,t)=>E([a,t-l],[e-48,l],[211,272],[2,l]),D=(e,t)=>E([a,t-l-d],[e-48,d],[96,160],[1,1]),R=(e,t)=>E([0,l],[a,t-44],[186,273],[a,2]),z=(e,t)=>E([e-a,l],[a,t-44],[186,273],[a,2]),W=(e,t)=>E([0,t-44-d],[a,l],[66,272],[a,l]),H=(e,t)=>E([e-a,t-44-d],[a,l],[42,272],[a,l]),L=(e,t)=>E([a,t-44-d],[e-48,l],[211,272],[2,l]),j=(e,t)=>E([31,P(t)],[c,50],[0,192],[128,80]),V=(e,t)=>E([e-a-c-7,P(t)],[c,50],[0,192],[128,80]),N=e=>e/2-16,_=e=>(e-l-d)/2-16,Y=[422,272],X=[454,272],q=[0,352],Z=[64,352],J=[32,64],K=[64,32],Q=(e,t)=>E([a,_(t)],[12,32],Y,J),$=(e,t)=>E([e-a-12,_(t)],[12,32],X,J),ee=(e,t)=>E([N(e),t-l-d-32],[32,12],q,K),te=(e,t)=>E([N(e),l],[32,12],Z,K),ie=(e,t)=>[e/2-26,t-l-32-26],re=[214,272],ne=[370,272],se=[318,272],oe=[266,272],ae=e=>e-50-l-7+4,le=(e,t)=>[35,ae(t)],de=(e,t)=>[61,ae(t)],ce=(e,t)=>[87,ae(t)],ue=(e,t)=>[e-a-7-c+4+0,ae(t)],he=(e,t)=>[e-a-7-c+4+26,ae(t)],fe=(e,t)=>[e-a-7-c+4+52,ae(t)],me=[le,de,ce],we=[ue,he,fe];function ge(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const pe=(e,t)=>{const i=e[0],r=e[1],n=t[0],s=t[1];return[[i,r],[i+n,r],[i,r+s],[i+n,r+s]]},ve=(e,t)=>{const i=e[0]/f,r=e[1]/f,n=t[0]/f,s=t[1]/f;return[[i,r+s],[i+n,r+s],[i,r],[i+n,r]]},Ae=e=>{const t=[],i=[],r=[];let n=0;for(const s of e){const e=pe(s.spritePos,s.spriteSize),o=ve(s.atlasPos,s.atlasSize);t.push(...e.flat()),i.push(...o.flat()),r.push(n,n+1,n+2,n+1,n+2,n+3),n+=4}return{positions:t,uvs:i,indices:r}};function Ce(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let be=null;const ye=e=>new Promise(((t,i)=>{const r=new Image;r.onload=()=>t(r),r.onerror=i,r.src=e}));function xe(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Se(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var Be,Ie,Me,Ee,Pe,Fe=i(72),ke=i.n(Fe),Te=i(825),Ue=i.n(Te),Oe=i(659),Ge=i.n(Oe),De=i(56),Re=i.n(De),ze=i(540),We=i.n(ze),He=i(113),Le=i.n(He),je=i(365),Ve={};Ve.styleTagTransform=Le(),Ve.setAttributes=Re(),Ve.insert=Ge().bind(null,"head"),Ve.domAPI=Ue(),Ve.insertStyleElement=We(),ke()(je.A,Ve),je.A&&je.A.locals&&je.A.locals;let Ne=class{constructor(){w(this,"adapter",null),w(this,"device",null),w(this,"canvas",null),w(this,"context",null),w(this,"currentFrameCommandEncoder",null),w(this,"currentFramePassEncoder",null)}async init(e){this.canvas=e;try{const e=navigator.gpu;if(!e)throw new Error("WebGPU is not supported");if(this.adapter=await e.requestAdapter(),!this.adapter)throw new Error("WebGPU no adapter found");if(this.device=await this.adapter.requestDevice(),!this.device)throw new Error("WebGPU no device found");const t=navigator.gpu.getPreferredCanvasFormat();this.context=this.canvas.getContext("webgpu");const i={device:this.device,format:t,alphaMode:"premultiplied",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.context.configure(i),g=this}catch(e){throw console.error(e),e}}getColorTextureView(){if(!this.context)throw new Error("WebGPU context not initialized");return this.context.getCurrentTexture().createView()}getDevice(){if(!this.device)throw new Error("WebGPU device not initialized");return this.device}beginFrame(){if(!this.device)throw new Error("WebGPU device not initialized");const e={colorAttachments:[{view:this.getColorTextureView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]};this.currentFrameCommandEncoder=this.device.createCommandEncoder(),this.currentFramePassEncoder=this.currentFrameCommandEncoder.beginRenderPass(e)}endFrame(){if(!this.device)throw new Error("WebGPU device not initialized");if(!this.currentFramePassEncoder||!this.currentFrameCommandEncoder)throw new Error("WebGPU beginFrame() was not called");this.currentFramePassEncoder.end(),this.device.queue.submit([this.currentFrameCommandEncoder.finish()])}getPassEncoder(){if(!this.currentFramePassEncoder)throw new Error("WebGPU beginFrame() was not called");return this.currentFramePassEncoder}},_e=class extends v{constructor(){super(...arguments),S(this,"device",null),S(this,"drawData",null)}async init(e,t){if(!g)throw new Error("WebGpuInstance is not initialized");this.baseInit(e,t),this.device=g.getDevice();const i=A(this.device,[[0,0],[s,0],[0,s],[s,s]],Float32Array,GPUBufferUsage.VERTEX),r=A(this.device,[[0,1,2],[1,2,3]],Uint32Array,GPUBufferUsage.INDEX),{maxDrawColCount:n,maxDrawRowCount:o}=this.getMaxFieldRowAndColCount(this.windowWidth,this.windowHeight),a=C(this.device,n*o*4,Uint32Array,GPUBufferUsage.VERTEX),l=C(this.device,n*o*2,Float32Array,GPUBufferUsage.VERTEX),d=new Uint32Array(5);d[0]=6,d[1]=o*n,d[2]=0,d[3]=0,d[4]=0;const c=this.device.createBuffer({size:20,usage:GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(c,0,d,0,d.length);const u=(e,t)=>"vec2f(".concat(.125*e,", ").concat(.125*t+.125,"), \n                vec2f(").concat(.125*e+.125,", ").concat(.125*t+.125,"), \n                vec2f(").concat(.125*e,", ").concat(.125*t,"), \n                vec2f(").concat(.125*e+.125,", ").concat(.125*t,")"),h=[u(0,0),u(1,0),u(2,0),u(3,0),u(4,0),u(5,0),u(6,0),u(7,0),u(0,1),u(1,1),u(2,1),u(3,1),u(4,1),u(5,1),u(6,1),u(7,1),u(0,2),u(1,2),u(2,2),u(3,2),u(4,2),u(5,2),u(6,2)],f={code:"struct VSIn {\r\n    @location(0) pos: vec2f,\r\n    @location(1) tid: u32,\r\n    @location(2) offset: vec2f,\r\n};\r\n\r\nstruct VSOut {\r\n    @builtin(position) position: vec4f,\r\n    @location(0) uv: vec2f,\r\n};\r\n\r\nconst tid = array<vec2f, {{UV_COUNT}}>(\r\n    {{UV}}\r\n);\r\n\r\nstruct Matrices {\r\n    projection: mat4x4f,\r\n    model: mat4x4f,\r\n};\r\n\r\n@group(1) @binding(0) var<uniform> matrices: Matrices;\r\n\r\n@vertex\r\nfn main(attributes: VSIn, @builtin(instance_index) instanceIndex : u32, @builtin(vertex_index) vertexIndex : u32) -> VSOut {\r\n    var vsOut: VSOut;\r\n\r\n    var inPos = attributes.pos + attributes.offset;\r\n    vsOut.position = matrices.projection * matrices.model * vec4f(inPos.x , inPos.y, 0, 1);\r\n    vsOut.uv = tid[attributes.tid * 4 + vertexIndex];\r\n    \r\n    return vsOut;\r\n}".replace("{{UV_COUNT}}","".concat(4*h.length)).replace("{{UV}}",h.join(",\n"))},m=this.device.createShaderModule(f),w=this.device.createShaderModule({code:"@group(0) @binding(0) var uSampler: sampler;\r\n@group(0) @binding(1) var uFieldTextureAtlas: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(@location(0) inUV: vec2f) -> @location(0) vec4f {\r\n    return textureSample(uFieldTextureAtlas, uSampler, inUV);\r\n}"}),p={bindGroupLayouts:[this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]})]},v={label:"field-pipeline",layout:this.device.createPipelineLayout(p),vertex:{module:m,entryPoint:"main",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x2"}],arrayStride:8,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"uint32"}],arrayStride:4,stepMode:"instance"},{attributes:[{shaderLocation:2,offset:0,format:"float32x2"}],arrayStride:8,stepMode:"instance"}]},fragment:{module:w,entryPoint:"main",targets:[{format:"bgra8unorm"}]}},b=this.device.createRenderPipeline(v),x=this.device.createSampler({magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest"}),S=await y(this.device,"assets/textures/field_atlas_dark.png"),B=this.device.createBindGroup({layout:b.getBindGroupLayout(0),entries:[{binding:0,resource:x},{binding:1,resource:S.createView()}]}),I=await y(this.device,"assets/textures/field_atlas_light.png"),M=this.device.createBindGroup({layout:b.getBindGroupLayout(0),entries:[{binding:0,resource:x},{binding:1,resource:I.createView()}]}),E=C(this.device,32,Float32Array,GPUBufferUsage.UNIFORM),P=this.device.createBindGroup({layout:b.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:E}}]});this.drawData={pipeline:b,positionBuffer:i,indicesBuffer:r,offsetBuffer:l,fieldMatricesBuffer:E,textureIdBuffer:a,fieldMatricesUniformBindGroup:P,fieldTextureUniformBindGroupDark:B,fieldTextureUniformBindGroupLight:M,drawValues:c}}update(e,t){if(!this.device)throw new Error("WebGpuField is not initialized");if(!this.drawData)throw new Error("WebGpuField drawData in not created!");const{maxDrawColCount:i,maxDrawRowCount:r}=this.getMaxFieldRowAndColCount(this.windowWidth,this.windowHeight),n=new Float32Array(i*r*2);for(let e=0;e<r*i;e++){const t=Math.floor(e/i),r=e%i;n[2*e+0]=r*s,n[2*e+1]=t*s}const{col:o,row:a}=this.getHoveredCell(t),l=this.isMouseInside(t),d=t.isMouseButtonPressed(0),c=e.isCellExists(o,a)&&e.isCellOpened(o,a),u=new Uint32Array(r*i),h=Math.ceil(this.cameraPosition.x/s),f=Math.ceil(this.cameraPosition.y/s);for(let t=0;t<r*i;t++){const r=Math.floor(t/i)-f,n=t%i-h,s=e.isGamePlaying()&&l&&d&&(o===n&&a===r||c&&Math.abs(o-n)<=1&&Math.abs(a-r)<=1);u[t]=this.getFieldTextureId(e,n,r,s)}var m,w;this.device.queue.writeBuffer(this.drawData.textureIdBuffer,0,u),this.device.queue.writeBuffer(this.drawData.offsetBuffer,0,n),this.device.queue.writeBuffer(this.drawData.fieldMatricesBuffer,0,((e,t)=>{const i=new Float32Array(e.length+t.length);return i.set(e),i.set(t,e.length),i})(b(0,this.windowWidth,0,this.windowHeight,-1,1),(m=24+this.cameraPosition.x%s,w=22+this.cameraPosition.y%s,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,m,w,0,1]))))}draw(){if(!g)throw new Error("WebGpuInstance is not initialized");if(!this.drawData)throw new Error("WebGpuField drawData in not created!");const e=null==g?void 0:g.getPassEncoder();e.setPipeline(this.drawData.pipeline),e.setViewport(0,0,this.windowWidth,this.windowHeight,0,1),e.setScissorRect(0,0,this.windowWidth,this.windowHeight),"dark"===x()?e.setBindGroup(0,this.drawData.fieldTextureUniformBindGroupDark):e.setBindGroup(0,this.drawData.fieldTextureUniformBindGroupLight),e.setBindGroup(1,this.drawData.fieldMatricesUniformBindGroup),e.setVertexBuffer(0,this.drawData.positionBuffer),e.setVertexBuffer(1,this.drawData.textureIdBuffer),e.setVertexBuffer(2,this.drawData.offsetBuffer),e.setIndexBuffer(this.drawData.indicesBuffer,"uint32"),e.drawIndexedIndirect(this.drawData.drawValues,0)}},Ye=class extends M{constructor(){super(...arguments),ge(this,"device",null),ge(this,"drawData",null),ge(this,"staticIndicesCount",0),ge(this,"dynamicIndicesCount",0)}async init(e,t){if(!g)throw new Error("WebGpuInstance is not initialized");this.baseInit(e,t),this.device=g.getDevice();const{positions:i,uvs:r,indices:n}=Ae([F(),k(e),T(0,t),U(e,t),O(e),G(e,t),D(e,t),R(0,t),z(e,t),W(0,t),H(e,t),L(e,t),j(0,t),V(e,t)]),s=A(this.device,i,Float32Array,GPUBufferUsage.VERTEX),o=A(this.device,r,Float32Array,GPUBufferUsage.VERTEX),a=A(this.device,n,Uint32Array,GPUBufferUsage.INDEX);this.staticIndicesCount=n.length;const{positions:l,uvs:d,indices:c}=Ae([E(le(0,t),h,[0,0],[0,0]),E(de(0,t),h,[0,0],[0,0]),E(ce(0,t),h,[0,0],[0,0]),E(ue(e,t),h,[0,0],[0,0]),E(he(e,t),h,[0,0],[0,0]),E(fe(e,t),h,[0,0],[0,0]),E(ie(e,t),[u,u],[0,0],[0,0]),te(e),ee(e,t),Q(0,t),$(e,t)]),f=A(this.device,l,Float32Array,GPUBufferUsage.VERTEX),m=C(this.device,d.length*Float32Array.BYTES_PER_ELEMENT,Float32Array,GPUBufferUsage.VERTEX),w=A(this.device,c,Uint32Array,GPUBufferUsage.INDEX);this.dynamicIndicesCount=c.length;const p=this.device.createShaderModule({code:"struct VSIn {\r\n    @location(0) pos: vec2f,\r\n    @location(1) uv: vec2f,\r\n};\r\n\r\nstruct VSOut {\r\n    @builtin(position) Position: vec4f,\r\n    @location(0) uv: vec2f,\r\n};\r\n\r\nstruct Matrices {\r\n    projection: mat4x4f,\r\n};\r\n\r\n@group(1) @binding(0) var<uniform> matrices: Matrices;\r\n\r\n@vertex\r\nfn main(attributes: VSIn, @builtin(instance_index) instanceIndex : u32, @builtin(vertex_index) vertexIndex : u32) -> VSOut {\r\n    var vsOut: VSOut;\r\n    \r\n    var inPos = attributes.pos;\r\n    vsOut.Position = matrices.projection * vec4f(inPos.x , inPos.y, 0, 1);\r\n    vsOut.uv = attributes.uv;\r\n\r\n    return vsOut;\r\n}"}),v=this.device.createShaderModule({code:"@group(0) @binding(0) var uSampler: sampler;\r\n@group(0) @binding(1) var uFieldTextureAtlas: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(@location(0) inUV: vec2f) -> @location(0) vec4f {\r\n    var color = textureSample(uFieldTextureAtlas, uSampler, inUV);\r\n    if (color.a < 0.001) {\r\n        discard;\r\n    }\r\n    return color;\r\n}"}),x={bindGroupLayouts:[this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]})]},S={label:"ui-pipeline",layout:this.device.createPipelineLayout(x),vertex:{module:p,entryPoint:"main",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x2"}],arrayStride:8,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float32x2"}],arrayStride:8,stepMode:"vertex"}]},fragment:{module:v,entryPoint:"main",targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}},B=this.device.createRenderPipeline(S),I=this.device.createSampler({magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest"}),M=await y(this.device,"assets/textures/field_atlas_dark.png"),P=this.device.createBindGroup({layout:B.getBindGroupLayout(0),entries:[{binding:0,resource:I},{binding:1,resource:M.createView()}]}),N=await y(this.device,"assets/textures/field_atlas_light.png"),_=this.device.createBindGroup({layout:B.getBindGroupLayout(0),entries:[{binding:0,resource:I},{binding:1,resource:N.createView()}]}),Y=C(this.device,16,Float32Array,GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(Y,0,b(0,e,0,t,-1,1));const X=this.device.createBindGroup({layout:B.getBindGroupLayout(1),entries:[{binding:0,resource:{buffer:Y}}]});this.drawData={pipeline:B,staticPositionBuffer:s,staticIndicesBuffer:a,staticTextureCoordBuffer:o,dynamicPositionBuffer:f,dynamicIndicesBuffer:w,dynamicTextureCoordBuffer:m,uiMatricesUniformBindGroup:X,uiTextureUniformBindGroupDark:P,uiTextureUniformBindGroupLight:_}}update(e,t,i){if(!this.device)throw new Error("WebGpuUi is not initialized");if(!this.drawData)throw new Error("WebGpuUi drawData in not created!");const r=Math.min(e.getClosedAndNotMarkedMinesCount(),999),n=new Float32Array(88),s=[Math.floor(r/100)%10,Math.floor(r/10)%10,r%10];for(let e=0;e<3;e++){const t=I[s[e]];n.set(ve(t,o).flat(),4*e*2)}const a=Math.min(e.getSecondsFromStart(),999),l=[Math.floor(a/100)%10,Math.floor(a/10)%10,a%10];for(let e=3;e<6;e++){const t=I[l[e-3]];n.set(ve(t,o).flat(),4*e*2)}this.isMouseInsideFace(i)&&this.mouseOnFaceDown?n.set(ve(oe,[u,u]).flat(),48):e.isGameOver()?n.set(ve(se,[u,u]).flat(),48):e.isGameWin()?n.set(ve(ne,[u,u]).flat(),48):n.set(ve(re,[u,u]).flat(),48),n.set(t.isOnBottom?ve([500,500],[1,1]).flat():ve(Z,K).flat(),56),n.set(t.isOnTop?ve([500,500],[1,1]).flat():ve(q,K).flat(),64),n.set(t.isOnLeft?ve([500,500],[1,1]).flat():ve(Y,J).flat(),72),n.set(t.isOnRight?ve([500,500],[1,1]).flat():ve(X,J).flat(),80),this.device.queue.writeBuffer(this.drawData.dynamicTextureCoordBuffer,0,n)}draw(){if(!g)throw new Error("WebGpuInstance is not initialized");if(!this.drawData)throw new Error("WebGpuField drawData in not created!");const e=null==g?void 0:g.getPassEncoder();e.setPipeline(this.drawData.pipeline),e.setViewport(0,0,this.windowWidth,this.windowHeight,0,1),e.setScissorRect(0,0,this.windowWidth,this.windowHeight),"dark"===x()?e.setBindGroup(0,this.drawData.uiTextureUniformBindGroupDark):e.setBindGroup(0,this.drawData.uiTextureUniformBindGroupLight),e.setBindGroup(1,this.drawData.uiMatricesUniformBindGroup),e.setVertexBuffer(0,this.drawData.staticPositionBuffer),e.setVertexBuffer(1,this.drawData.staticTextureCoordBuffer),e.setIndexBuffer(this.drawData.staticIndicesBuffer,"uint32"),e.drawIndexed(this.staticIndicesCount,1,0,0,0),e.setVertexBuffer(0,this.drawData.dynamicPositionBuffer),e.setVertexBuffer(1,this.drawData.dynamicTextureCoordBuffer),e.setIndexBuffer(this.drawData.dynamicIndicesBuffer,"uint32"),e.drawIndexed(this.dynamicIndicesCount,1,0,0,0)}};Ne=class{constructor(){Ce(this,"canvas",null),Ce(this,"context",null)}async init(e){this.canvas=e,this.context=this.canvas.getContext("2d"),be=this}getContext(){if(!this.context)throw new Error("HtmlCanvasInstance is not initialized");return this.context}beginFrame(){if(!this.canvas||!this.context)throw new Error("HtmlCanvasInstance is not initialized");this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}endFrame(){}},_e=class extends v{constructor(){super(...arguments),xe(this,"context",null),xe(this,"drawData",null),xe(this,"textureIdArray",new Uint8Array(0))}async init(e,t){if(!be)throw new Error("HtmlCanvasInstance is not initialized");this.baseInit(e,t),this.context=be.getContext();const{maxDrawColCount:i,maxDrawRowCount:r}=this.getMaxFieldRowAndColCount(this.windowWidth,this.windowHeight);this.textureIdArray=new Uint8Array(i*r);const n=await ye("assets/textures/field_atlas_dark.png"),s=await ye("assets/textures/field_atlas_light.png");this.drawData={uiTextureDark:n,uiTextureLight:s}}update(e,t){const{maxDrawColCount:i,maxDrawRowCount:r}=this.getMaxFieldRowAndColCount(this.windowWidth,this.windowHeight),{col:n,row:o}=this.getHoveredCell(t),a=this.isMouseInside(t),l=t.isMouseButtonPressed(0),d=e.isCellExists(n,o)&&e.isCellOpened(n,o),c=Math.ceil(this.cameraPosition.x/s),u=Math.ceil(this.cameraPosition.y/s);for(let t=0;t<r*i;t++){const r=Math.floor(t/i)-u,s=t%i-c,h=e.isGamePlaying()&&a&&l&&(n===s&&o===r||d&&Math.abs(n-s)<=1&&Math.abs(o-r)<=1);this.textureIdArray[t]=this.getFieldTextureId(e,s,r,h)}}drawRect(e,t){if(!this.context)throw new Error("HtmlCanvasUi is not initialized");if(!this.drawData)throw new Error("WebGpuUi drawData in not created!");const i="dark"===x()?this.drawData.uiTextureDark:this.drawData.uiTextureLight,r=[t%8*s*2,Math.floor(t/8)*s*2];this.context.drawImage(i,r[0],r[1],64,64,e[0],this.windowHeight-e[1]-s,s,s)}draw(){const e=24+this.cameraPosition.x%s,t=22+this.cameraPosition.y%s,{maxDrawColCount:i,maxDrawRowCount:r}=this.getMaxFieldRowAndColCount(this.windowWidth,this.windowHeight);for(let n=0;n<r*i;n++){const r=Math.floor(n/i),o=n%i;this.drawRect([o*s+e,r*s+t],this.textureIdArray[n])}}},Ye=class extends M{constructor(){super(...arguments),Se(this,"context",null),Se(this,"drawData",null),Se(this,"closedMines",0),Se(this,"seconds",0),Se(this,"faceState","default"),Se(this,"fieldCameraState",{isOnBottom:!1,isOnLeft:!1,isOnRight:!1,isOnTop:!1})}async init(e,t){if(!be)throw new Error("HtmlCanvasInstance is not initialized");this.baseInit(e,t),this.context=be.getContext();const i=await ye("assets/textures/field_atlas_dark.png"),r=await ye("assets/textures/field_atlas_light.png");this.drawData={uiTextureDark:i,uiTextureLight:r}}update(e,t,i){this.closedMines=Math.min(e.getClosedAndNotMarkedMinesCount(),999),this.seconds=Math.min(e.getSecondsFromStart(),999),this.fieldCameraState=t,this.faceState="default",this.isMouseInsideFace(i)&&this.mouseOnFaceDown?this.faceState="press":e.isGameOver()?this.faceState="lose":e.isGameWin()&&(this.faceState="win")}drawRect(e){if(!this.context)throw new Error("HtmlCanvasUi is not initialized");if(!this.drawData)throw new Error("WebGpuUi drawData in not created!");const t="dark"===x()?this.drawData.uiTextureDark:this.drawData.uiTextureLight;this.context.drawImage(t,e.atlasPos[0],e.atlasPos[1],e.atlasSize[0],e.atlasSize[1],e.spritePos[0],this.windowHeight-e.spritePos[1]-e.spriteSize[1],e.spriteSize[0],e.spriteSize[1])}draw(){if(!this.context)throw new Error("HTMLCanvasUi is not initialized");this.drawRect(F(this.windowWidth,this.windowHeight)),this.drawRect(k(this.windowWidth,this.windowHeight)),this.drawRect(T(this.windowWidth,this.windowHeight)),this.drawRect(U(this.windowWidth,this.windowHeight)),this.drawRect(O(this.windowWidth,this.windowHeight)),this.drawRect(G(this.windowWidth,this.windowHeight)),this.drawRect(D(this.windowWidth,this.windowHeight)),this.drawRect(R(this.windowWidth,this.windowHeight)),this.drawRect(z(this.windowWidth,this.windowHeight)),this.drawRect(W(this.windowWidth,this.windowHeight)),this.drawRect(H(this.windowWidth,this.windowHeight)),this.drawRect(L(this.windowWidth,this.windowHeight)),this.drawRect(j(this.windowWidth,this.windowHeight)),this.drawRect(V(this.windowWidth,this.windowHeight));const e=[Math.floor(this.closedMines/100)%10,Math.floor(this.closedMines/10)%10,this.closedMines%10];for(let t=0;t<3;t++){const i=I[e[t]];this.drawRect(E(me[t](this.windowWidth,this.windowHeight),h,i,o))}const t=[Math.floor(this.seconds/100)%10,Math.floor(this.seconds/10)%10,this.seconds%10];for(let e=0;e<3;e++){const i=I[t[e]];this.drawRect(E(we[e](this.windowWidth,this.windowHeight),h,i,o))}let i=re;"press"===this.faceState?i=oe:"win"===this.faceState?i=ne:"lose"===this.faceState&&(i=se),this.drawRect(E(ie(this.windowWidth,this.windowHeight),[u,u],i,[u,u])),this.fieldCameraState.isOnTop||this.drawRect(ee(this.windowWidth,this.windowHeight)),this.fieldCameraState.isOnLeft||this.drawRect(Q(this.windowWidth,this.windowHeight)),this.fieldCameraState.isOnRight||this.drawRect($(this.windowWidth,this.windowHeight)),this.fieldCameraState.isOnBottom||this.drawRect(te(this.windowWidth,this.windowHeight))}},(()=>{let e="light";if(localStorage.getItem("theme"))"dark"==localStorage.getItem("theme")&&(e="dark");else{if(!window.matchMedia)return!1;window.matchMedia("(prefers-color-scheme: dark)").matches&&(e="dark")}"dark"==e&&document.documentElement.setAttribute("data-theme","dark")})();const Xe=document.querySelector('#theme-switch input[type="checkbox"]'),qe=document.querySelector("#theme-switch img");Xe.addEventListener("change",(function(e){e.target.checked?(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-theme","dark"),Xe.checked=!0,qe.src="assets/img/theme_dark.png"):(localStorage.setItem("theme","light"),document.documentElement.setAttribute("data-theme","light"),Xe.checked=!1,qe.src="assets/img/theme_light.png")}),!1),null===(Be=document.getElementById("form-field"))||void 0===Be||Be.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(document.getElementById("form-field")),i=parseInt(t.get("cols")||"0"),r=parseInt(t.get("rows")||"0"),n=parseInt(t.get("mines")||"0");i&&r&&n&&(n>=i*r?document.getElementById("error-message").innerHTML="Mines count must be less than field size":m(i,r,n))})),null===(Ie=document.getElementById("new-game-beginner"))||void 0===Ie||Ie.addEventListener("click",(()=>{m("9","9","10")})),null===(Me=document.getElementById("new-game-intermediate"))||void 0===Me||Me.addEventListener("click",(()=>{m("16","16","40")})),null===(Ee=document.getElementById("new-game-expert"))||void 0===Ee||Ee.addEventListener("click",(()=>{m("30","16","99")})),null===(Pe=document.getElementById("load-game"))||void 0===Pe||Pe.addEventListener("click",(()=>{window.location.href="?load=true"})),"dark"==x()?(Xe.checked=!0,qe.src="assets/img/theme_dark.png"):(Xe.checked=!1,qe.src="assets/img/theme_light.png");const{cols:Ze,rows:Je,mines:Ke,load:Qe}=(()=>{const e=new URLSearchParams(window.location.search);return{cols:parseInt(e.get("cols")||"9"),rows:parseInt(e.get("rows")||"9"),mines:parseInt(e.get("mines")||"10"),load:e.get("load")}})(),$e=new class{constructor(e,t){this.fieldSize=e,this.mines=t,this.field=[],this.fieldState=new Uint8Array,this.markedMinesCount=0,this.closedCellsCount=this.getFieldSize(),this.cellsToOpen=this.closedCellsCount-this.mines,this.isFirstClick=!0,this.gameState="playing",this.recursiveOpenNodeStack=[]}isCellExists(e,t){return e>=0&&e<this.fieldSize[0]&&t>=0&&t<this.fieldSize[1]}checkCellExistsError(e,t){if(e<0||e>=this.fieldSize[0]||t<0||t>=this.fieldSize[1])throw new Error("Cell is out of field")}getFieldRowSize(){return this.fieldSize[1]}getFieldColSize(){return this.fieldSize[0]}getFieldMinesCount(){return this.mines}getFieldCellId(e,t){return this.checkCellExistsError(e,t),e+t*this.fieldSize[0]}setFieldSizeAndMines(e,t){this.fieldSize=e,this.mines=t}isCellHasMine(e,t){return this.field[this.getFieldCellId(e,t)]}getFieldSize(){return this.fieldSize[0]*this.fieldSize[1]}getClosedAndNotMarkedMinesCount(){return Math.max(0,this.mines-this.markedMinesCount)}getSecondsFromStart(){const e=this.endTime||new Date;return Math.floor(this.startTime?(e.getTime()-this.startTime.getTime())/1e3:0)}isCellOpened(e,t){return(16&this.fieldState[this.getFieldCellId(e,t)])>0}isCellMarked(e,t){return(32&this.fieldState[this.getFieldCellId(e,t)])>0}isCellClosed(e,t){return!this.isCellOpened(e,t)}getCellMinesCount(e,t){return 15&this.fieldState[this.getFieldCellId(e,t)]}getCellMinesCountById(e){return 15&this.fieldState[e]}getColAndRowFromCellId(e){return{col:e%this.fieldSize[0],row:Math.floor(e/this.fieldSize[0])}}generateField(){if(this.field=new Array(this.getFieldSize()).fill(!1),this.fieldState=new Uint8Array(this.getFieldSize()).fill(0),this.markedMinesCount=0,this.closedCellsCount=this.getFieldSize(),this.cellsToOpen=this.closedCellsCount-this.mines,this.startTime=void 0,this.endTime=void 0,this.gameState="playing",this.isFirstClick=!0,this.recursiveOpenNodeStack=[],this.mines>=this.field.length)return this.field=new Array(this.field.length).fill(!0),this.fieldState=new Uint8Array(this.getFieldSize()).fill(9),this.mines=this.field.length,void(this.cellsToOpen=0);let e=this.mines;for(;e>0;){const t=Math.floor(Math.random()*this.field.length);if(!this.field[t]){this.field[t]=!0,e--;const{col:i,row:r}=this.getColAndRowFromCellId(t);for(let e=-1;e<=1;e++)for(let t=-1;t<=1;t++){const n=i+e,s=r+t;if(this.isCellExists(n,s)){const e=this.getFieldCellId(n,s);this.fieldState[e]+=1}}}}}isGamePlaying(){return"playing"===this.gameState}isGameEnded(){return"playing"!==this.gameState}isGameOver(){return"gameover"===this.gameState}isGameWin(){return"win"===this.gameState}onGameOver(){this.gameState="gameover",this.endTime=new Date}openCellsRecursively(){for(let e=0;e<100;e++){const e=this.recursiveOpenNodeStack.shift();if(void 0===e){this.recursiveOpenNodeStack=[];break}const{col:t,row:i}=this.getColAndRowFromCellId(e);if(!this.isCellOpened(t,i)&&!this.isCellMarked(t,i)){if(this.fieldState[e]|=16,this.closedCellsCount--,0===this.getCellMinesCountById(e))for(let e=-1;e<=1;e++)for(let r=-1;r<=1;r++){const n=t+e,s=i+r;if(this.isCellExists(n,s)){const e=this.getFieldCellId(n,s);this.isCellClosed(n,s)&&this.recursiveOpenNodeStack.push(e)}}if(0===this.recursiveOpenNodeStack.length){this.recursiveOpenNodeStack=[];break}}}}openCell(e,t){if("playing"!==this.gameState||this.recursiveOpenNodeStack.length>0)return;const i=this.isFirstClick;if(this.isFirstClick=!1,void 0===this.startTime&&(this.startTime=new Date),!this.isCellMarked(e,t)){if(this.isCellHasMine(e,t)){if(!i)return this.fieldState[this.getFieldCellId(e,t)]|=16,void this.onGameOver();{const i=this.getFieldCellId(e,t);let r=-1,n=1e3;for(;-1===r&&n-- >0;){const e=Math.floor(Math.random()*this.field.length);this.field[e]||(r=e)}if(-1===r)for(let e=0;e<this.field.length;e++)if(!this.field[e]&&i!==e){r=e;break}this.field[i]=!1,this.field[r]=!0;const{col:s,row:o}=this.getColAndRowFromCellId(r);for(let i=-1;i<=1;i++)for(let r=-1;r<=1;r++){const n=e+i,a=t+r;if(this.isCellExists(n,a)){const e=this.getFieldCellId(n,a);this.fieldState[e]-=1}const l=s+i,d=o+r;if(this.isCellExists(l,d)){const e=this.getFieldCellId(l,d);this.fieldState[e]+=1}}}}if(this.isCellOpened(e,t)){const i=this.getCellMinesCount(e,t);let r=!1,n=0,s=0;for(let i=-1;i<=1;i++)for(let o=-1;o<=1;o++){const a=e+i,l=t+o;this.isCellExists(a,l)&&this.isCellMarked(a,l)&&(n++,this.isCellHasMine(a,l)||(r=!0)),this.isCellExists(a,l)&&this.isCellClosed(a,l)&&s++}if(i===n){if(r){for(let i=-1;i<=1;i++)for(let r=-1;r<=1;r++){const n=e+i,s=t+r;this.isCellExists(n,s)&&!this.isCellMarked(n,s)&&(this.fieldState[this.getFieldCellId(n,s)]|=16)}return void this.onGameOver()}this.recursiveOpenNodeStack=[];for(let i=-1;i<=1;i++)for(let r=-1;r<=1;r++){const n=e+i,s=t+r;if(this.isCellExists(n,s)&&!this.isCellMarked(n,s)){const e=this.getFieldCellId(n,s);this.recursiveOpenNodeStack.push(e)}}}else if(i===s)for(let i=-1;i<=1;i++)for(let r=-1;r<=1;r++){const n=e+i,s=t+r;this.isCellExists(n,s)&&!this.isCellMarked(n,s)&&this.isCellClosed(n,s)&&this.markCell(n,s)}}else{const i=this.getFieldCellId(e,t);this.recursiveOpenNodeStack=[i]}}}markCell(e,t){if("playing"!==this.gameState||this.recursiveOpenNodeStack.length>0)return;this.isFirstClick=!1;const i=this.getFieldCellId(e,t);void 0===this.startTime&&(this.startTime=new Date),this.isCellOpened(e,t)||(this.isCellMarked(e,t)?(this.fieldState[i]&=-33,this.markedMinesCount--):(this.fieldState[i]|=32,this.markedMinesCount++))}update(){this.openCellsRecursively(),this.getFieldSize()-this.closedCellsCount===this.cellsToOpen&&"playing"===this.gameState&&(this.gameState="win",this.endTime=new Date)}save(){return{fieldSize:this.fieldSize,mines:this.mines,field:this.field,fieldState:Array.from(this.fieldState),markedMinesCount:this.markedMinesCount,closedCellsCount:this.closedCellsCount,cellsToOpen:this.cellsToOpen,startTime:this.startTime,endTime:this.endTime,gameState:this.gameState,isFirstClick:this.isFirstClick,recursiveOpenNodeStack:this.recursiveOpenNodeStack}}load(e){this.fieldSize=e.fieldSize,this.mines=e.mines,this.field=e.field,this.fieldState=new Uint8Array(e.fieldState),this.markedMinesCount=e.markedMinesCount,this.closedCellsCount=e.closedCellsCount,this.cellsToOpen=e.cellsToOpen,this.startTime=e.startTime,this.endTime=e.endTime,this.gameState=e.gameState,this.isFirstClick=e.isFirstClick,this.recursiveOpenNodeStack=e.recursiveOpenNodeStack}consolePrint(){const e=[];for(let t=0;t<this.fieldSize[1];t++){let i="";for(let e=0;e<this.fieldSize[0];e++)i+=this.isCellHasMine(e,t)?"@":"#";e.push(i)}console.log(e.reverse().join("\n"))}}([Ze,Je],Ke),et=async()=>{const{width:e,height:t}=((e,t)=>({width:Math.min(1280,e*s+48),height:Math.min(720,t*s+66+d)}))($e.getFieldColSize(),$e.getFieldRowSize()),i=document.getElementById("app");i.width=e,i.height=t;const r=new Ne,o=new n(i);await r.init(i);const a=new _e;await a.init(i.width,i.height);const l=new Ye;await l.init(i.width,i.height),o.setOnMouseButtonUp((e=>{if(0===e){const e=a.getHoveredCell(o);a.isMouseInside(o)&&$e.isCellExists(e.col,e.row)&&$e.openCell(e.col,e.row),l.checkFaceClickUp($e,o)}})),o.setOnMouseButtonDown((e=>{if(0===e&&l.checkFaceClickDown(o),2===e){const e=a.getHoveredCell(o);$e.isCellExists(e.col,e.row)&&$e.markCell(e.col,e.row)}})),o.setOnWheel(((e,t)=>{a.moveCamera($e,e,t)}));const c=()=>{$e.update(),a.update($e,o),l.update($e,a.getFieldCameraState($e),o),r.beginFrame(),a.draw(),l.draw(),r.endFrame(),requestAnimationFrame(c)};requestAnimationFrame(c)},tt=new class{constructor(e,t){var i,r,n;i=this,n=null,(r=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(r="db"))in i?Object.defineProperty(i,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[r]=n;const s=window.indexedDB.open("minesweeper",1);s.onsuccess=()=>{this.db=s.result,e()},s.onerror=()=>{t()},s.onupgradeneeded=()=>{this.db=s.result,this.db.createObjectStore("games",{keyPath:"id"})}}saveGame(e){var t;const i=e.save(),r=null===(t=this.db)||void 0===t?void 0:t.transaction("games","readwrite"),n=null==r?void 0:r.objectStore("games");null==n||n.put({id:1,data:i})}loadGame(e,t,i){var r;const n=null===(r=this.db)||void 0===r?void 0:r.transaction("games","readonly"),s=null==n?void 0:n.objectStore("games"),o=null==s?void 0:s.get(1);o?(o.onsuccess=()=>{console.log(o),o.result?(e.load(o.result.data),t()):i()},o.onerror=()=>{}):console.error("Error loading game")}}((()=>{var e;null===(e=document.getElementById("save-game"))||void 0===e||e.addEventListener("click",(()=>{tt.saveGame($e)})),Qe&&tt.loadGame($e,(()=>{var e,t,i;null===(e=document.getElementById("field-cols"))||void 0===e||e.setAttribute("value",$e.getFieldColSize().toString()),null===(t=document.getElementById("field-rows"))||void 0===t||t.setAttribute("value",$e.getFieldRowSize().toString()),null===(i=document.getElementById("field-mines"))||void 0===i||i.setAttribute("value",$e.getFieldMinesCount().toString());const r=new URLSearchParams(window.location.search);r.delete("load"),console.log(r.toString()),history.replaceState(null,"","?"+r.toString()),et()}),(()=>{document.getElementById("error-message").innerHTML="Error loading game"}))}),(()=>{Qe&&(document.getElementById("error-message").innerHTML="Error loading game")}));var it,rt,nt;Qe||(null===(it=document.getElementById("field-cols"))||void 0===it||it.setAttribute("value",Ze.toString()),null===(rt=document.getElementById("field-rows"))||void 0===rt||rt.setAttribute("value",Je.toString()),null===(nt=document.getElementById("field-mines"))||void 0===nt||nt.setAttribute("value",Ke.toString()),$e.generateField(),et())}();
//# sourceMappingURL=app.js.map